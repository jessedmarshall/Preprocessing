function [params, resnorm, frameToFit] = fit2DgaussToImgSubregion(frameToFit,...	thisRegionLabeled, maxPixelLoc, fitWidth, displayFramesToFit)imgSize=size(frameToFit);   % get info about the region that shares the same max time   info=regionprops(thisRegionLabeled, 'Centroid', 'BoundingBox', 'Orientation');		if ~isempty(info)    % restrict to local area around the maximum    [maxY, maxX]=ind2sub(imgSize,maxPixelLoc);    leftLim=min(maxX-fitWidth, info.BoundingBox(1));    leftLim=max(1,round(leftLim));    rightLim=max(maxX+fitWidth, info.BoundingBox(1)+info.BoundingBox(3));    rightLim=min(imgSize(2),round(rightLim));    topLim=min(maxY-fitWidth, info.BoundingBox(2));    topLim=max(1,round(topLim));    bottomLim=max(maxY+fitWidth, info.BoundingBox(2)+info.BoundingBox(4));    bottomLim=min(imgSize(1), round(bottomLim));    if displayFramesToFit        figure(97);        subplot(131); imagesc(frameToFit);        hold on        plot([leftLim rightLim rightLim leftLim leftLim], [bottomLim bottomLim topLim topLim bottomLim], 'k', 'Linewidth', 1.5)        hold off    end    frameToFit=frameToFit(topLim:bottomLim,leftLim:rightLim);    [xdata,ydata]=meshgrid(leftLim:rightLim, topLim:bottomLim);    % get initial fit parameters based on region properties    muy=info.Centroid(2);    mux=info.Centroid(1);    sigx=info.BoundingBox(3)/2;    sigx(sigx<2)=2;    sigy=info.BoundingBox(4)/2;    sigy(sigy<2)=2;    theta=info.Orientation*pi/180;  % theta should be clockwise rotation    A=double(max(frameToFit(:)));    % set param fit initialization, upper bounds, lower bounds    initParams=[mux, muy, sigx, sigy, theta, A];     lowerBounds=[-4, -4, 2, 2, -pi/2, 0];    maxWidth=max(max(rightLim-leftLim, topLim-bottomLim)/3, fitWidth);    upperBounds=[imgSize(2)+4,imgSize(1)+4,maxWidth,maxWidth,pi/2,2*A];    % perform fit    options.Display='off';    try        [params,resnorm,~,~] = lsqcurvefit(@gfun, initParams, [ydata(:), xdata(:)],...            frameToFit(:), lowerBounds, upperBounds, options);    catch       disp('fit failed for 1 gaussian')       params=[];       resnorm=[];       frameToFit=[];    endelse   params=[];   resnorm=[];   frameToFit=[];end